var $$=Dom7;$mainUrl="http://myschoolchart.com/unileverbe/rest/";var theme="auto";if(document.location.search.indexOf("theme=")>=0){theme=document.location.search.split("theme=")[1].split("&")[0]}var app=new Framework7({theme:"md",init:false,cache:false,view:{pushState:true},root:"#app",name:"SOLViT",id:"co.ke.solvit",panel:{swipe:"right"},routes:routes});var $$=app.$;if(app.device.desktop){app.dialog.alert("We've detected you are using a desktop device to view this app, for the best user experience, kindly view it on your smartphone., ",null)}var mainView=app.view.create(".view-main");app.on("pageInit",function(b){var a=b.name;if(a!=="login"){if(!localStorage.userId){mainView.router.load({url:"./pages/login-page.html",ignoreCache:true,reload:true})}}});app.on("pageBeforeIn",function(b){$(".panel-right").removeClass("opacity-none");$(".panel-backdrop").removeClass("opacity-none");var a=b.name;if(a==="login"){}else{if(a==="adopt-a-store"){adoptAStoreFunctions(b)}else{if(a==="stores-page"){getStores()}else{if(a==="store-status"){setUpStoreStatus(b)}else{if(a==="visits-history"){$(".panel-right").addClass("opacity-none");$(".panel-backdrop").addClass("opacity-none");getVisitsHistory(b)}else{if(a==="record-sales"){$(".panel-right").addClass("opacity-none");$(".panel-backdrop").addClass("opacity-none");getProductsForSale()}else{if(a==="product-details"){setUpProductForSale(b);getStoresForSell()}else{if(a==="products"){$(".panel-right").addClass("opacity-none");$(".panel-backdrop").addClass("opacity-none");getProducts()}else{if(a==="reports-page"){setReports()}else{if(a==="group-chat"){setUpGroupChat()}else{if(a==="customers-page"){getKiosks()}else{if(a==="profile-page"){$("[data-profileData='name']").html(localStorage.fullName);$("[data-profileData='phone']").html(localStorage.userPhone);$("[data-profileData='email']").html(localStorage.userEmail);$("[data-profileData='group']").html("Group #"+localStorage.userGroup)}}}}}}}}}}}}});$("body").on("click","#loginBtn",function(c){c.preventDefault();var b=$("#loginUsername").val();var a=$("#loginPassword").val();if(b===null||a===""){app.dialog.alert("All fields are mandatory!",null);return}app.dialog.preloader("Loading...");var d=$mainUrl+"login.php";app.request.post(d,{username:b,password:a,appid:"123"},function(g,f,h){console.log("Response: ",g);app.dialog.close();if(g.status==="SUCCESS"){var e=g.data;console.log("User data: ",e.userid);localStorage.userId=e.userid;localStorage.fullName=e.names;localStorage.userPhone=e.phone;localStorage.userEmail=e.email;localStorage.userGroup=e.group;localStorage.login=1;app.dialog.alert("Login successful",function(){mainView.router.load({url:"./index.html",ignoreCache:true,reload:true})})}else{app.dialog.alert("Your username or password is incorrect. Try Again!",null)}},function(f,e){app.dialog.close();console.log("Error"+f);app.dialog.alert("Connection Error! Check your internet connection and try again.!",null)},"json")});app.init();var adoptAStoreFunctions=function(a){var b=a.route.params;console.log(b.id)};var getStores=function(){app.dialog.preloader("Fetching stores...");var a=$mainUrl+"Shops.php";app.request.post(a,{appid:"123",type:1},function(c,b,f){app.dialog.close();if(c.status==="SUCCESS"){var e=c.data;$$("#store-list-item").empty();for(var d=0;d<e.length;d++){$$("#store-list-item").append(storesListItem(e[d].id,e[d].name,e[d].locationname))}}else{app.dialog.alert("Connection Error! Check your internet connection and try again.",null)}},function(c,b){app.dialog.close();app.dialog.alert("Connection Error! Check your internet connection and try again!",null)},"json")};var storesListItem=function(a,b,d){var c='<li><a href="/store-status/'+a+"/"+b+"/"+d+'/" class="item-link item-content"><div class="item-media"><img src="assets/img/store.png" alt="" class="list-item-media-left"/></div><div class="item-inner"><div class="item-title">'+b+'<div class="item-header">'+d+'</div></div><div class="item-after">View</div></div></a></li>';return c};var setUpStoreStatus=function(a){var g=a.route.params;var h=g.id;var f=g.name;var d=g.location;var c=new Date();var e=c.getDate();var i=c.getMonth();var b=c.getFullYear();app.calendar.create({inputEl:"#status-date",value:[new Date()],dateFormat:"m-dd-yyyy",rangePicker:false,openIn:"customModal",header:true,footer:true,onClose:function(){}});$$("#status-name").val(f);$$("#status-location").val(d);$$("#status-store-id").val(h)};$("body").on("click","#record-visit",function(){var d="";$('input[type="checkbox"]:checked').each(function(){d+=$(this).val()+","});var b=$("#status-store-id").val();var c=$("#status-summary").val();var f=d;var g=$("#status-issues-summary").val();var e=$$("#status-date").val();var a={store:b,surveysummary:c,issues:f,issuesdetails:g,surveydate:e,appid:"123"};if(c===""){app.dialog.alert("The summary cannot be blank!",null);return}else{if(e===""){app.dialog.alert("Please select a date!",null);return}}app.dialog.preloader("Sending...");var h=$mainUrl+"PostSurvey.php";app.request.post(h,a,function(j,i,k){app.dialog.close();if(j.status==="SUCCESS"){app.dialog.alert("Data recorded successfully",function(){mainView.router.load({url:"./pages/stores-page.html",ignoreCache:true,reload:true})})}else{app.dialog.alert("Connection Error! Check your internet connection and try again.",null)}},function(j,i){app.dialog.close();app.dialog.alert("Connection Error! Check your internet connection and try again!",null)},"json")});var getVisitsHistory=function(a){app.dialog.preloader("Fetching history...");var b=$mainUrl+"Surveys.php";app.request.post(b,{appid:"123"},function(e,d,g){app.dialog.close();if(e.status==="SUCCESS"){var c=e.data;console.log("Data ",c);$$("#history-table-body tbody").empty();for(var f=0;f<c.length;f++){if(c[f].surveydate===""){continue}$("#history-table-body tbody").append(visitHistoryListItem(c[f].surveydate,c[f].id,c[f].shop,c[f].surveysummary,c[f].issues))}}else{app.dialog.alert("Connection Error! Check your internet connection and try again.",null)}},function(d,c){app.dialog.close();app.dialog.alert("Connection Error! Check your internet connection and try again!",null)},"json")};var visitHistoryListItem=function(e,f,b,d,c){var a='<tr><td class="label-cell">'+e+'</td><td class="numeric-cell">#'+f+'</td><td class="label-cell">'+b+'</td><td class="label-cell">'+d+'</td><td class="label-cell">'+c+"</td></tr>";return a};var getProductsForSale=function(){app.dialog.preloader("Fetching Products...");var a=$mainUrl+"Products.php";app.request.post(a,{appid:"123"},function(c,b,e){app.dialog.close();if(c.status==="SUCCESS"){var f=c.data;console.log("Data ",f);$$("#products-table tbody").empty();$$("#products-lister").empty();for(var d=0;d<f.length;d++){if(f[d].id===""){continue}$("#products-lister").append(productsForSaleListItem(f[d].barcode,f[d].id,f[d].name,f[d].price,f[d].barcode,f[d].description,f[d].image))}}else{app.dialog.alert("Connection Error! Check your internet connection and try again.",null)}},function(c,b){app.dialog.close();app.dialog.alert("Connection Error! Check your internet connection and try again!",null)},"json")};var getProducts=function(){app.dialog.preloader("Fetching Products...");var a=$mainUrl+"Products.php";app.request.post(a,{appid:"123"},function(c,b,e){app.dialog.close();if(c.status==="SUCCESS"){var f=c.data;console.log("Data ",f);$$("#products-table tbody").empty();for(var d=0;d<f.length;d++){if(f[d].id===""){continue}$("#products-table tbody").append(productsListItem(f[d].barcode,f[d].id,f[d].name,f[d].price,f[d].barcode,f[d].description,f[d].image,f[d].description))}}else{app.dialog.alert("Connection Error! Check your internet connection and try again.",null)}},function(c,b){app.dialog.close();app.dialog.alert("Connection Error! Check your internet connection and try again!",null)},"json")};var productsForSaleListItem=function(b,c,e,f,b,a,g){var d='<li class="item-content"><a href="/product-details/'+c+"/"+e+"/"+f+"/"+g+"/"+b+'/" style="display:inherit;color: #7d1754;"><div class="item-media"><img src="assets/img/royco-sm.png" width="44"/></div><div class="item-inner"><div class="item-title-row"><div class="item-title">'+e+'</div></div><div class="item-subtitle">@'+f+"</div></div></a></li>";return d};var productsListItem=function(c,d,e,f,c,a,g,a){var b='<tr><td class="label-cell">#'+d+'</td><td class="label-cell">'+e+'</td><td class="label-cell">'+f+'</td><td class="label-cell">'+a+'</td><td class="label-cell">'+c+"</td></tr>";return b};var setUpProductForSale=function(b){console.log("Page Info",b);if($.isEmptyObject(b.route.params)){var k=b.route.query}else{var k=b.route.params}var f=k.id;var j=k.name;var a=k.barcode;var i=k.price;var g=k.image;var d=new Date();var h=d.getDate();var l=d.getMonth();var c=d.getFullYear();app.calendar.create({inputEl:"#sales-date",value:[new Date()],dateFormat:"m-dd-yyyy",rangePicker:false,openIn:"customModal",header:true,footer:true,onClose:function(){}});$$("#product-barcode").val(a);$$("#product-name").val(j);$$("#product-price").val(i);$$("#product-id").val(f);$$("#product-image").attr("src","assets/img/royco.jpg");var e=app.stepper.create({el:".stepper",inputEl:"#product-quantity",on:{change:function(){var n=$("#product-price").val();var m=e.getValue()*n;$("#product-total-price").val(m)}}})};$("body").on("click","#sell-btn",function(h){h.preventDefault();var b=$("#store-list-select").val();var a=$("#product-total-price").val();var d=$("#product-id").val();var g=$("#product-quantity").val();var c=$$("#sales-date").val();var f=localStorage.userId;if(a<=0){return}if(d===""||f===""){return}if(c===""){app.dialog.alert("Please select a date!",null);return}app.dialog.confirm("Confirm you want to proceed",null,function(){sellProduct(b,f,d,g,c)},function(){})});var sellProduct=function(c,g,e,f,d){app.dialog.preloader("Sending...");var b=$mainUrl+"RecordASale.php";var a={store:c,agent:g,product:e,quantity:f,sdate:d,appid:"123"};app.request.post(b,a,function(i,h,j){app.dialog.close();if(i.status==="SUCCESS"){app.dialog.alert("Sales recorded successfully",function(){mainView.router.load({url:"./pages/record-sales.html",ignoreCache:true,reload:true})})}else{app.dialog.alert("Connection Error! Check your internet connection and try again.",null)}},function(i,h){app.dialog.close();app.dialog.alert("Connection Error! Check your internet connection and try again!",null)},"json")};var getStoresForSell=function(){var a=$mainUrl+"Shops.php";app.request.post(a,{appid:"123",type:2},function(c,b,f){app.dialog.close();if(c.status==="SUCCESS"){var e=c.data;$$("#store-list-select").empty();for(var d=0;d<e.length;d++){$$("#store-list-select").append('<option value="'+e[d].id+'" selected>'+e[d].name+"</option>")}}else{console.log("Connection Error! Check your internet connection and try again.")}},function(c,b){console.log("Connection Error! Check your internet connection and try again!")},"json")};$("body").on("click","#scan-barcode-btn",function(a){cordova.plugins.barcodeScanner.scan(function(b){app.dialog.preloader("Processing...");var c="Barcode\nResult: "+b.text+"\nFormat: "+b.format+"\n";getProductByBarcode(b.text)},function(b){app.dialog.alert("Scanning failed: "+b)},{preferFrontCamera:false,showFlipCameraButton:false,showTorchButton:true,torchOn:false,saveHistory:true,prompt:"Place a barcode inside the scan area",resultDisplayDuration:500,orientation:"portrait",disableAnimations:true,disableSuccessBeep:false})});var getProductByBarcode=function(a){var b=$mainUrl+"ProductsNew.php";app.request.post(b,{barcode:a,appid:"123"},function(d,c,e){console.log("Response: ",d);app.dialog.close();if(d.status==="SUCCESS"){var g=d.data;var f="./pages/product-details.html?id="+g.id+"&name="+g.name+"&price="+g.price+"&image=royco.jpg&barcode="+a+"";mainView.router.load({url:f,ignoreCache:true,reload:true})}else{app.dialog.alert("Product not found!",null)}},function(d,c){app.dialog.close();app.dialog.alert("Connection Error! Check your internet connection and try again.!",null)},"json")};var setReports=function(){var a=document.getElementById("salesChart").getContext("2d");var b=new Chart(a,{type:"bar",data:{labels:["Mon","Tues","Wed","Thur","Fri","Sat"],datasets:[{label:"# of Sales",data:[12,19,3,5,2,3],backgroundColor:["rgba(125, 23, 84, 0.58)","rgba(125, 23, 84, 0.58)","rgba(125, 23, 84, 0.58)","rgba(125, 23, 84, 0.58)","rgba(125, 23, 84, 0.58)","rgba(125, 23, 84, 0.58)"],borderColor:["rrgba(125, 23, 84, 0.25)","rgba(125, 23, 84, 0.25)","rgba(125, 23, 84, 0.25)","rgba(125, 23, 84, 0.25)","rgba(125, 23, 84, 0.25)","rgba(125, 23, 84, 0.25)"],borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:true}}]}}})};var setUpGroupChat=function(){var d=app.messages.create({el:".messages",firstMessageRule:function(g,h,i){if(g.isTitle){return false}if(!h||h.type!==g.type||h.name!==g.name){return true}return false},lastMessageRule:function(g,h,i){if(g.isTitle){return false}if(!i||i.type!==g.type||i.name!==g.name){return true}return false},tailMessageRule:function(g,h,i){if(g.isTitle){return false}if(!i||i.type!==g.type||i.name!==g.name){return true}return false}});var a=app.messagebar.create({el:".messagebar"});var b=false;$$(".send-link").on("click",function(){var g=a.getValue().replace(/\n/g,"<br>").trim();if(!g.length){return}a.clear();a.focus();d.addMessage({text:g});if(b){return}f()});var e=["Yes!","No","Hm...","I am not sure"];var c=[{name:"Kate Johnson",avatar:"http://lorempixel.com/100/100/people/9"},{name:"Blue Ninja",avatar:"http://lorempixel.com/100/100/people/7"}];var f=function(){b=true;setTimeout(function(){var h=e[Math.floor(Math.random()*e.length)];var g=c[Math.floor(Math.random()*c.length)];d.showTyping({header:g.name+" is typing",avatar:g.avatar});setTimeout(function(){d.addMessage({text:h,type:"received",name:g.name,avatar:g.avatar});d.hideTyping();b=false},4000)},1000)}};$("body").on("click","#save-kiosk",function(h){h.preventDefault();var g=$("#kiosk-name").val();var a=$("#kiosk-contacts").val();var i="";var f=$("#kiosk-email").val();var d=$("#kiosk-location").val();if(g===""||a===""||f===""||d==""){app.dialog.alert("All fields are mandatory!",null);return}app.dialog.preloader("Saving...");var c=$mainUrl+"CreateShop.php";var b={name:g,phone1:a,phone2:i,email:f,type:2,location:d,appid:"123"};app.request.post(c,b,function(j,e,k){app.dialog.close();if(j.status==="SUCCESS"){app.dialog.alert("Saved successfully",function(){mainView.router.load({url:"./pages/customers.html",ignoreCache:true,reload:true})})}else{app.dialog.alert("Connection Error! Check your internet connection and try again.",null)}},function(j,e){app.dialog.close();app.dialog.alert("Connection Error! Check your internet connection and try again!",null)},"json")});var getKiosks=function(){app.dialog.preloader("Loading Kioks...");var a=$mainUrl+"Shops.php";app.request.post(a,{appid:"123",type:2},function(c,b,f){app.dialog.close();if(c.status==="SUCCESS"){var e=c.data;$$("#kiosk-listview").empty();for(var d=0;d<e.length;d++){$("#kiosk-listview").append(kiosksListItem(e[d].id,e[d].name,e[d].phone1,e[d].location))}}else{console.log("Connection Error! Check your internet connection and try again.")}},function(c,b){app.dialog.close();console.log("Connection Error! Check your internet connection and try again!")},"json")};var kiosksListItem=function(b,a,e,d){var c='<li><a href="/store-status/'+b+'/" class="item-link item-content"><div class="item-media"><img src="assets/img/avatar.png" alt="" class="list-item-media-left"/></div><div class="item-inner"><div class="item-title">'+a+'<div class="item-header">'+e+'</div><div class="item-footer">'+d+'</div></div><div class="item-after">&nbsp;</div></div></a></li>';return c};