<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#fed300" />
    <title>Modern Mail | A Modern Delivery Service</title>
    <meta name="author" content="Chris Muiruri">
    <meta name="description" content="">
    <meta name="keywords" content="">

    <!-- CSS FILES -->
    <link rel="stylesheet" href="css/lineicons.css">
    <link rel="stylesheet" href="css/swiper.min.css">
    <!-- <link rel="stylesheet" href="css/odometer.min.css"> -->
    <link rel="stylesheet" href="css/fancybox.min.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.0.4/tailwind.min.css">
    <link rel="stylesheet" href="css/index.processed.css">

    <style>
        .bottom-bg-half:before {
            display: none;
        }
    </style>
</head>

<body>

    <div id="app">

        <div class="preloader"> <img src="images/logo.7ff27d68.png" alt="Image"> </div>
        <!-- end preloader -->
        <div class="page-transition"></div>
        <!-- end page-transition -->
        <aside class="side-widget">
            <div class="inner">
                <div class="logo"> <a href="index.html"><img src="images/logo.7ff27d68.png"
                            srcset="images/logo.7ff27d68.png" alt="Image"></a> </div>
                <!-- end logo -->
                <div class="hide-mobile">
                    <p>Modern Mail provides reliable local and regional delivery service.</p>
                    <figure class="gallery"><a href="images/recent-news01.jpg" data-fancybox><img
                                src="images/recent-news01.jpg" alt="Image"></a><a href="images/recent-news02.jpg"
                            data-fancybox><img src="images/recent-news02.jpg" alt="Image"></a></figure>
                    <h6 class="widget-title">CONTACT INFO</h6>
                    <address class="address">
                        <p>+254 (0) 23 00 006<br>
                            <a href="#">sales@modernmail.co.ke</a>
                        </p>
                    </address>
                    <h6 class="widget-title">FOLLOW US</h6>
                    <ul class="social-media">
                        <li><a href="#"><i class="lni lni-facebook-filled"></i></a></li>
                        <li><a href="#"><i class="lni lni-twitter-original"></i></a></li>
                        <li><a href="#"><i class="lni lni-instagram"></i></a></li>
                        <li><a href="#"><i class="lni lni-youtube"></i></a></li>
                        <li><a href="#"><i class="lni lni-pinterest"></i></a></li>
                    </ul>
                </div>
                <!-- end hide-mobile -->
                <div class="show-mobile">
                    <div class="custom-menu">
                        <ul>
                            <li><a href="#">En</a></li>
                            <li><a href="#">Fr</a></li>
                        </ul>
                    </div>
                    <!-- end custom-menu -->
                    <div class="site-menu">
                        <ul>
                            <li><a href="#">Home</a></li>
                            <li><a href="#shipment-form">Tracking</a></li>
                            <li><a href="#">Contact</a></li>
                            <li>
                                <a href="./index.html" @click.prevent="logout" v-if="isUserLoggedIn">Logout</a>

                                <a href="./login.html" v-if="!isUserLoggedIn">Login</a>
                            </li>
                        </ul>
                    </div>
                    <!-- end site-menu -->
                </div>
                <!-- end show-mobile -->
                <small>&copy; 2021 Modern Mail | Delivery Services Company</small>
            </div>
            <!-- end inner -->
        </aside>
        <!-- end side-widget -->
        <div class="topbar">
            <div class="container">
                <div class="phone">Call Us Now: <a href="#"> +254 (0) 23 00 006 </a></div>
                <!-- end phone -->
                <div class="email"> Email: <a href="#">sales@modernmail.co.ke</a> </div>
                <!-- end email -->
                <div class="social-media"> <span>Follow us</span>
                    <ul>
                        <li><a href="#"><i class="lni lni-facebook-filled"></i> <span>Facebook</span></a></li>
                        <li><a href="#"><i class="lni lni-twitter-original"></i> <span>Twitter</span></a></li>
                        <li><a href="#"><i class="lni lni-linkedin-original"></i> <span>Linkedin</span></a></li>
                    </ul>
                </div>
                <!-- end social-media -->
            </div>
            <!-- end container -->
        </div>
        <!-- end topbar -->
        <nav class="navbar">
            <div class="container">
                <div class="inner">
                    <div class="logo"> <a href="index.html"> <img src="images/logo.7ff27d68.png"
                                srcset="images/logo.7ff27d68.png" alt="Image"> </a> </div>
                    <!-- end logo -->
                    <div class="custom-menu">
                        <ul>
                            <li><a href="#">En</a></li>
                            <li><a href="#">Fr</a></li>
                        </ul>
                    </div>
                    <!-- end custom-menu -->
                    <div class="site-menu">
                        <ul>
                            <li><a href="#">Home</a></li>
                            <li><a href="#shipment-form">Tracking</a></li>
                            <li><a href="#">Contact</a></li>
                        </ul>
                    </div>
                    <!-- end site-menu -->
                    <div class="hamburger-menu"> <span></span> <span></span> <span></span> </div>
                    <!-- end hamburger-menu -->
                    <div class="navbar-button">
                        <a href="./index.html" @click.prevent="logout" v-if="isUserLoggedIn">LOGOUT</a>


                        <a href="./login.html" v-if="!isUserLoggedIn">LOGIN</a>
                    </div>
                    <!-- end navbar-button -->
                </div>
                <!-- end inner -->
            </div>
            <!-- end container -->
        </nav>
        <!-- end navbar -->

        <div v-if="!isUserLoggedIn">

            <section class="content-section no-bottom-spacing bottom-bg-half">
                <div class="container">
                    <div class="row">
                        <!-- end col-12 -->
                        <div class="col-md-12 col-xs-12">

                            <!-- Send Reset Code -->
                            <div class="p-4 mb-10" v-if="showSendVerifyCode">

                                <h6 class="mb-4 text-center text-2xl">Forgot Password</h6>
                                <div class="bg-white shadow-sm p-4 md:p-6 max-w-xl mx-auto">

                                    <form method="post" autocomplete="off" @submit.prevent="sendResetCode()">

                                        <div class="input-wrapper mb-6">
                                            <label
                                                clas="block text-sm text-gray-600 dark:text-gray-400 mb-3">Email:</label>
                                            <input autocomplete="username" id="username" v-model="mainForm.username"
                                                type="email" placeholder="e.g. jumabalala@gmail.com" required
                                                class="w-full px-3 py-2 placeholder-gray-300 border border-gray-300 focus:outline-none focus:ring focus:ring-indigo-100 focus:border-indigo-300 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500 dark:border-gray-600 dark:focus:ring-gray-900 dark:focus:border-gray-500">
                                        </div>

                                        <div role="alert" class="mb-6" v-if="mainFormSubmitted">
                                            <div
                                                :class="{'border rounded-b px-4 py-3':true, 'border-red-400 bg-red-100 text-red-700':mainFormHasError, 'border-green-400 bg-green-100 text-green-700':mainFormSuccess}">
                                                <p v-html="mainFormMessage"></p>
                                            </div>
                                        </div>

                                        <div class="mb-6">
                                            <button type="submit"
                                                class="px-4 py-2 text-white bg-blue hover:opacity-50 focus:bg-indigo-600 focus:outline-none">Send
                                                reset code</button>
                                            <div class="my-6">
                                                <div class="mb-2">
                                                    <a href="./register.html" class="inline-block">I don't have an
                                                        account?</a>
                                                </div>
                                                <div>
                                                    <a href="./login.html" class="inline-block">Login</a>
                                                </div>
                                            </div>
                                        </div>
                                    </form>

                                </div>
                                <!-- end row inner -->
                            </div>

                            <!-- Verify Reset Code -->
                            <div class="p-4 mb-10" v-if="showVerifyCodeForm">

                                <h6 class="mb-4 text-center text-2xl">Verify Reset Code</h6>
                                <div class="bg-white shadow-sm p-4 md:p-6 max-w-xl mx-auto">

                                    <form method="post" autocomplete="off" @submit.prevent="resetPassword()">

                                        <p class="mb-4 font-bold" v-html="mainFormMessage"></p>

                                        <div class="input-wrapper mb-4">
                                            <label for="code"
                                                clas="block text-sm text-gray-600 dark:text-gray-400 mb-3">Enter
                                                reset code:</label>
                                            <input autocomplete="code" id="code" v-model="verifyCodeFormData.code"
                                                type="text" placeholder="******" required
                                                class="w-full px-3 py-2 placeholder-gray-300 border border-gray-300 focus:outline-none focus:ring focus:ring-indigo-100 focus:border-indigo-300 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500 dark:border-gray-600 dark:focus:ring-gray-900 dark:focus:border-gray-500">
                                        </div>

                                        <div class="input-wrapper mb-4">
                                            <label for="pass"
                                                clas="block text-sm text-gray-600 dark:text-gray-400 mb-3">New
                                                Password:</label>
                                            <input autocomplete="pass" id="pass" v-model="verifyCodeFormData.password"
                                                type="password" placeholder="********" required
                                                class="w-full px-3 py-2 placeholder-gray-300 border border-gray-300 focus:outline-none focus:ring focus:ring-indigo-100 focus:border-indigo-300 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500 dark:border-gray-600 dark:focus:ring-gray-900 dark:focus:border-gray-500">
                                        </div>

                                        <div class="input-wrapper mb-6">
                                            <label clas="block text-sm text-gray-600 dark:text-gray-400 mb-3">Confirm
                                                Password:</label>
                                            <input v-model="verifyCodeFormData.password_confirmation" type="password"
                                                placeholder="********" required
                                                class="w-full px-3 py-2 placeholder-gray-300 border border-gray-300 focus:outline-none focus:ring focus:ring-indigo-100 focus:border-indigo-300 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500 dark:border-gray-600 dark:focus:ring-gray-900 dark:focus:border-gray-500">
                                        </div>

                                        <div role="alert" class="mb-6" v-if="verifyCodeForm.submitted">
                                            <div
                                                :class="{'border rounded-b px-4 py-3':true, 'border-red-400 bg-red-100 text-red-700':verifyCodeForm.hasError, 'border-green-400 bg-green-100 text-green-700':verifyCodeForm.success}">
                                                <p v-html="verifyCodeForm.message"></p>
                                            </div>
                                        </div>

                                        <div class="mb-6">
                                            <button type="submit" v-if="!verifyCodeForm.success"
                                                class="px-4 py-2 text-white bg-blue hover:opacity-50 focus:bg-indigo-600 focus:outline-none">Reset
                                                Password</button>
                                            <div class="my-6">
                                                <div class="mb-2" v-if="!verifyCodeForm.success">
                                                    <a href="#" @click.prevent="resendCode" class="inline-block">I
                                                        didn't get the code!</a>
                                                </div>
                                                <div class="mb-2">
                                                    <a href="./login.html" class="inline-block">Login</a>
                                                </div>
                                                <div>
                                                    <a href="./register.html" class="inline-block">I don't have an
                                                        account?</a>
                                                </div>
                                            </div>
                                        </div>
                                    </form>

                                </div>
                                <!-- end row inner -->
                            </div>

                            <!-- end calculator -->
                        </div>
                        <!-- end col-12 -->
                    </div>
                    <!-- end row -->
                </div>
                <!-- end container -->
            </section>
            <!-- end content-section -->

        </div>

        <section v-if="isUserLoggedIn" class="content-section no-bottom-spacing bottom-bg-half">
            <div class="container">
                <div class="row">
                    <!-- end col-12 -->
                    <div class="col-md-12 col-xs-12">
                        <div class="h-16 text-center"><a href="./account.html" class="text-blue-600 underline">My
                                Account Dashboard</a></div>
                    </div>
                </div>
            </div>
        </section>

        <footer class="footer">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 col-md-6">
                        <figure class="logo"> <img src="images/logo.7ff27d68.png" srcset="images/logo.7ff27d68.png"
                                alt="Image"> </figure>
                        <p>+254 (0) 23 00 006<br>
                            <a href="#">sales@modernmail.co.ke</a>
                        </p>
                        <p>2075 Industrial Area <br>
                            Nairobi - Kenya</p>
                    </div>
                    <!-- end col-4 -->
                    <div class="col-lg-4 col-md-6">
                        <h6 class="widget-title">Quick Links</h6>
                        <ul class="footer-menu">
                            <li><a href="#">Home</a></li>
                            <li><a href="#">Tracking</a></li>
                            <li><a href="#">Contact Us</a></li>
                        </ul>
                    </div>
                    <!-- end col-4 -->
                    <div class="col-lg-4">
                        <h6 class="widget-title">Subscribe Newsletter</h6>
                        <form>
                            <input type="email" placeholder="enter your email address...."
                                class="w-full px-3 py-2 placeholder-gray-300 border border-gray-300 focus:outline-none focus:ring focus:ring-indigo-100 focus:border-indigo-300 dark:bg-gray-700 dark:text-white dark:placeholder-gray-500 dark:border-gray-600 dark:focus:ring-gray-900 dark:focus:border-gray-500">
                            <input type="submit" value="Subscribe"
                                class="px-4 py-2 text-white bg-blue focus:bg-indigo-600 focus:outline-none">
                        </form>
                    </div>
                    <!-- end col-4 -->
                    <div class="col-12">
                        <div class="footer-bottom">
                            <span>&copy; 2021 Modern Mail | Delivery Service Company</span>
                            <span>Help</span>
                        </div>
                        <!-- end footer-bottom -->
                    </div>
                    <!-- end col-12 -->
                </div>
                <!-- end row -->
            </div>
            <!-- end container -->
        </footer>
        <!-- end footer -->


        <!-- JS FILES -->
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/fancybox.min.js"></script>
        <script src="js/swiper.min.js"></script>
        <!-- <script src="js/odometer.min.js"></script> -->
        <script src="js/imagesloaded.pkgd.min.js"></script>
        <script src="js/isotope.min.js"></script>
        <script src="js/scripts.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.12/vue.min.js"></script>

        <script>

            var app = new Vue({
                el: "#app",
                data() {
                    return {
                        isUserLoggedIn: false,
                        appName: "Modern Mail",
                        mainForm: {
                            "username": null
                        },
                        verifyCodeFormData: {
                            "username": null,
                            "password": null,
                            "password_confirmation": null,
                            "code": null,
                        },
                        mainFormSubmitted: false,
                        mainFormHasError: false,
                        mainFormSuccess: false,
                        mainFormMessage: "",
                        verifyCodeForm: {
                            title: "",
                            submitted: false,
                            hasError: false,
                            success: false,
                            message: "",
                        },
                        showSendVerifyCode: true,
                        showVerifyCodeForm: false,
                        showResetPasswordForm: false
                    }
                },
                created() {
                    console.log('App Created')
                },
                beforeMount() {
                    if (Cookies.get('access_token') !== undefined) {
                        this.isUserLoggedIn = true
                    }
                },
                beforeCreate() {
                    if (Cookies.get('access_token') !== undefined || Cookies.get('access_token') !== "") {
                        //redirect to accoutn page
                    }
                },
                methods: {
                    logout() {
                        let x = confirm('Are you sure?')
                        if (x) {
                            Cookies.remove('access_token')
                            this.isUserLoggedIn = false
                        }
                        return
                    },
                    sendResetCode() {
                        let self = this

                        self.onMainFormReset()

                        let axiosHeaders = {
                            headers: { "Content-Type": "application/json" },
                        };
                        let url = "https://api.courier.modernmail.co.ke/api/v2/request-password-reset ";
                        axios.post(url, this.mainForm, axiosHeaders)
                            .then((response) => {
                                console.log(response)
                                if (!response.data.success) {
                                    self.onMainFormError("Could not reset your password, try again!")
                                } else {
                                    self.showSendVerifyCode = false
                                    self.showVerifyCodeForm = true
                                    self.onMainFormSuccess(response.data.message)
                                }
                            })
                            .catch((err) => {
                                if (err.response.data.message) {
                                    if (err.response.data.errors) {
                                        let errors = err.response.data.errors
                                        let str = ''
                                        Object.keys(errors).forEach(key => {
                                            errors[key].forEach(error => {
                                                str += `${error} <br/>`
                                            })
                                        })
                                        self.onMainFormError(str)
                                    } else {
                                        self.onMainFormError(err.response.data.message)
                                    }
                                } else {
                                    self.onMainFormError("Login failed, try again!")
                                }
                            });
                    },
                    onMainFormError(msg) {
                        this.mainFormSubmitted = true;
                        this.mainFormHasError = true;
                        this.mainFormSuccess = false;
                        this.mainFormMessage = msg;
                    },
                    onMainFormSuccess(msg) {
                        this.mainFormSubmitted = true;
                        this.mainFormHasError = false;
                        this.mainFormSuccess = true;
                        this.mainFormMessage = `${msg}`;
                    },
                    onMainFormReset() {
                        this.mainFormSubmitted = false;
                        this.mainFormHasError = false;
                        this.mainFormSuccess = false;
                        this.mainFormMessage = "";
                    },
                    resendCode() {
                        let self = this

                        self.verifyCodeForm = {
                            submitted: false,
                            hasError: false,
                            success: false,
                            message: "",
                        };

                        self.onMainFormReset()

                        self.showSendVerifyCode = true
                        self.showVerifyCodeForm = false

                    },
                    resetPassword() {
                        let self = this

                        self.verifyCodeForm = {
                            submitted: false,
                            hasError: false,
                            success: false,
                            message: "",
                        };

                        if (self.verifyCodeFormData.password !== self.verifyCodeFormData.password_confirmation) {
                            self.verifyCodeForm.submitted = true
                            self.verifyCodeForm.hasError = true
                            self.verifyCodeForm.message = "Password do not match!"
                            return
                        }

                        self.verifyCodeFormData.username = self.mainForm.username

                        let axiosHeaders = {
                            headers: { "Content-Type": "application/json" },
                        };
                        let url = "https://api.courier.modernmail.co.ke/api/v2/send-password-reset";
                        axios.post(url, self.verifyCodeFormData, axiosHeaders)
                            .then((response) => {
                                self.verifyCodeForm.submitted = true
                                if (!response.data.success) {
                                    self.verifyCodeForm.hasError = true
                                    self.verifyCodeForm.message = "Could not reset your password, try again!"
                                } else {
                                    self.verifyCodeForm.hasError = false
                                    self.verifyCodeForm.success = true
                                    self.verifyCodeForm.message = `${response.data.message}  <a href="./login.html" class="underline font-bold">Login</a>`
                                }
                            })
                            .catch((err) => {
                                self.verifyCodeForm.submitted = true
                                if (err.response.data.message) {
                                    if (err.response.data.errors) {
                                        let errors = err.response.data.errors
                                        let str = ''
                                        Object.keys(errors).forEach(key => {
                                            errors[key].forEach(error => {
                                                str += `${error} <br/>`
                                            })
                                        })
                                        self.verifyCodeForm.hasError = true
                                        self.verifyCodeForm.success = false
                                        self.verifyCodeForm.message = str
                                    } else {
                                        self.verifyCodeForm.hasError = true
                                        self.verifyCodeForm.success = false
                                        self.verifyCodeForm.message = err.response.data.message
                                    }
                                } else {
                                    self.verifyCodeForm.submitted = true
                                    self.verifyCodeForm.hasError = true
                                    self.verifyCodeForm.success = false
                                    self.verifyCodeForm.message = "Could not reset your password, try again!"
                                }
                            });
                    },
                }
            })
        </script>
</body>

</html>